 {
  "width": 650,
  "height": 400,
  
  "signals": [
    {
      "name": "brushedScale",
      "init": "mpg",
      "streams": [
        {"type": "@filterRect:click", "expr": "datum.id"},
        {"type": "@brushRegion:mousedown", "expr": "datum.id"}
      ]
    },
    {
      "name": "cylStart",
      "init": 0,
      "streams": [{
        "type": "@brushRegion:mousedown", 
        "expr": "brushedScale == 'cyl' ? eventY() : cylStart"
      }]
    },
    {
      "name": "cylEnd",
      "init": 400,
      "streams": [{
        "type": "@brushRegion:mousedown, [@brushRegion:mousedown, window:mouseup] > window:mousemove",
        "expr": "brushedScale == 'cyl' ? clamp(eventY(), 0, 400) : cylEnd"      }]
    },
    {
      "name": "cylMin", 
      "init": 8,
      "expr": "cylStart == cylEnd ? 0 : min(cylStart, cylEnd)",
      "scale": {"name": "cyl", "invert": true}
    },
    {
      "name": "cylMax",
      "init": 3,
      "expr": "cylStart == cylEnd ? 400 : max(cylStart, cylEnd)",
      "scale": {"name": "cyl", "invert": true}
    },
    {
      "name": "cylMiddle",
      "init": 5.5,
      "expr": "( cylMin + cylMax ) / 2"
    },
    {
      "name": "dspStart",
      "init": 0,
      "streams": [{
        "type": "@brushRegion:mousedown", 
        "expr": "brushedScale == 'dsp' ? eventY() : dspStart"
      }]
    },
    {
      "name": "dspEnd",
      "init": 400,
      "streams": [{
        "type": "@brushRegion:mousedown, [@brushRegion:mousedown, window:mouseup] > window:mousemove",
        "expr": "brushedScale == 'dsp' ? clamp(eventY(), 0, 400) : dspEnd"
      }]
    },
    {
      "name": "dspMin",
      "init": 500,
      "expr": "dspStart == dspEnd ? 0 : min(dspStart, dspEnd)",
      "scale": {"name": "dsp", "invert": "true"}
    },
    {
      "name": "dspMax",
      "init": 50,
      "expr": "dspStart == dspEnd ? 400 : max(dspStart, dspEnd)",
      "scale": {"name": "dsp", "invert": "true"}
    },
    {
      "name": "dspMiddle",
      "init": 5.5,
      "expr": "( dspMin + dspMax ) / 2"
    },
    {
      "name": "lbsStart",
      "init": 0,
      "streams": [{
        "type": "@brushRegion:mousedown", 
        "expr": "brushedScale == 'lbs' ? eventY() : lbsStart"
      }]
    },
    {
      "name": "lbsEnd",
      "init": 400,
      "streams": [{
        "type": "@brushRegion:mousedown, [@brushRegion:mousedown, window:mouseup] > window:mousemove",
        "expr": "brushedScale == 'lbs' ? clamp(eventY(), 0, 400) : lbsEnd"
      }]
    },
    {
      "name": "lbsMin",
      "init": 5500,
      "expr": "lbsStart == lbsEnd ? 0 : min(lbsStart, lbsEnd)",
      "scale": {"name": "lbs", "invert": true}
    },
    {
      "name": "lbsMax",
      "init": 1500,
      "expr": "lbsStart == lbsEnd ? 400 : max(lbsStart, lbsEnd)",
      "scale": {"name": "lbs", "invert": true}
    },
    {
      "name": "lbsMiddle",
      "init": 5.5,
      "expr": "( lbsMin + lbsMax ) / 2"
    },
    {
      "name": "hpStart",
      "init": 0,
      "streams": [{
        "type": "@brushRegion:mousedown", 
        "expr": "brushedScale == 'hp' ? eventY() : hpStart"
      }]
    },
    {
      "name": "hpEnd",
      "init": 400,
      "streams": [{
        "type": "@brushRegion:mousedown, [@brushRegion:mousedown, window:mouseup] > window:mousemove",
        "expr": "brushedScale == 'hp' ? clamp(eventY(), 0, 400) : hpEnd"
      }]
    },
    {
      "name": "hpMin",
      "init": 240,
      "expr": "hpStart == hpEnd ? 0 : min(hpStart, hpEnd)",
      "scale": {"name": "hp", "invert": true}
    },
    {
      "name": "hpMax",
      "init": -20,
      "expr": "hpStart == hpEnd ? 400 : max(hpStart, hpEnd)",
      "scale": {"name": "hp", "invert": true}
    },
    {
      "name": "hpMiddle",
      "init": 5.5,
      "expr": "( hpMin + hpMax ) / 2"
    },
    {
      "name": "accStart",
      "init": 0,
      "streams": [{
        "type": "@brushRegion:mousedown", 
        "expr": "brushedScale == 'acc' ? eventY() : accStart"
      }]
    },
    {
      "name": "accEnd",
      "init": 400,
      "streams": [{
        "type": "@brushRegion:mousedown, [@brushRegion:mousedown, window:mouseup] > window:mousemove",
        "expr": "brushedScale == 'acc' ? clamp(eventY(), 0, 400) : accEnd"
      }]
    },
    { 
      "name": "accMin",
      "init": 26,
      "expr": "accStart == accEnd ? 0 : min(accStart, accEnd)",
      "scale": {"name": "acc", "invert": true}
    },
    { 
      "name": "accMax",
      "init": 8,
      "expr": "accStart == accEnd ? 400 : max(accStart, accEnd)",
      "scale": {"name": "acc", "invert": true}
    },
    {
      "name": "accMiddle",
      "init": 5.5,
      "expr": "( accMin + accMax ) / 2"
    },
    {
      "name": "mpgStart",
      "init": 0,
      "streams": [{
        "type": "@brushRegion:mousedown", 
        "expr": "brushedScale == 'mpg' ? eventY() : mpgStart"
      }]
    },
    {
      "name": "mpgEnd",
      "init": 400,
      "streams": [{
        "type": "@brushRegion:mousedown, [@brushRegion:mousedown, window:mouseup] > window:mousemove",
        "expr": "brushedScale == 'mpg' ? clamp(eventY(), 0, 400) : mpgEnd"
      }]
    },
    {
      "name": "mpgMin",
      "init": 50,
      "expr": "mpgStart == mpgEnd ? 0 : min(mpgStart, mpgEnd)",
      "scale": {"name": "mpg", "invert": true}
    },
    {
      "name": "mpgMax",
      "init": -5,
      "expr": "mpgStart == mpgEnd ? 400 : max(mpgStart, mpgEnd)",
      "scale": {"name": "mpg", "invert": true}
    },
    {
      "name": "mpgMiddle",
      "init": 5.5,
      "expr": "( mpgMin + mpgMax ) / 2"
    },
    {
      "name": "yearStart",
      "init": 0,
      "streams": [{
        "type": "@brushRegion:mousedown", 
        "expr": "brushedScale == 'year' ? eventY() : yearStart"
      }]
    },
    {
      "name": "yearEnd",
      "init": 400,
      "streams": [{
        "type": "@brushRegion:mousedown, [@brushRegion:mousedown, window:mouseup] > window:mousemove",
        "expr": "brushedScale == 'year' ? clamp(eventY(), 0, 400) : yearEnd"
      }]
    },
    {
      "name": "yearMin", 
      "init": 82,
      "expr": "yearStart == yearEnd ? 0 : min(yearStart, yearEnd)",
      "scale": {"name": "year", "invert": true}
    },
    {
      "name": "yearMax", 
      "init": 70,
      "expr": "yearStart == yearEnd ? 400 : max(yearStart, yearEnd)",
      "scale": {"name": "year", "invert": true}
    },
    {
      "name": "yearMiddle",
      "init": 5.5,
      "expr": "( yearMin + yearMax ) / 2"
    }
  ],
  
  "predicates": [
    {
      "name": "isCyl",
      "type": "==",
      "operands": [{"arg": "id"}, {"value": "cyl"}]
    },
    {
      "name": "isDsp",
      "type": "==",
      "operands": [{"arg": "id"}, {"value": "dsp"}]
    },
    {
      "name": "isLbs",
      "type": "==",
      "operands": [{"arg": "id"}, {"value": "lbs"}]
    },
    {
      "name": "isHp",
      "type": "==",
      "operands": [{"arg": "id"}, {"value": "hp"}]
    },
    {
      "name": "isAcc",
      "type": "==",
      "operands": [{"arg": "id"}, {"value": "acc"}]
    },
    {
      "name": "isMpg",
      "type": "==",
      "operands": [{"arg": "id"}, {"value": "mpg"}]
    },
    {
      "name": "isYear",
      "type": "==",
      "operands": [{"arg": "id"}, {"value": "year"}]
    },
    {
      "name": "isBrushed",
      "type": "==",
      "operands": [{"signal": "brushedScale"}, {"arg": "id"}]
    },
    {
      "name": "isBrushedCyl",
      "type": "and",
      "operands": [{"predicate": "isBrushed"}, {"predicate": "isCyl"}]
    },
    {
      "name": "isBrushedDsp",
      "type": "and",
      "operands": [{"predicate": "isBrushed"}, {"predicate": "isDsp"}]
    },
    {
      "name": "isBrushedLbs",
      "type": "and",
      "operands": [{"predicate": "isBrushed"}, {"predicate": "isLbs"}]
    },
    {
      "name": "isBrushedHp",
      "type": "and",
      "operands": [{"predicate": "isBrushed"}, {"predicate": "isHp"}]
    },
    {
      "name": "isBrushedAcc",
      "type": "and",
      "operands": [{"predicate": "isBrushed"}, {"predicate": "isAcc"}]
    },
    {
      "name": "isBrushedMpg",
      "type": "and",
      "operands": [{"predicate": "isBrushed"}, {"predicate": "isMpg"}]
    },
    {
      "name": "isBrushedYear",
      "type": "and",
      "operands": [{"predicate": "isBrushed"}, {"predicate": "isYear"}]
    },
    {
      "name": "cylRange",
      "type": "in",
      "item": {"arg": "cylValue"},
      "range": [{"signal": "cylMin"}, {"signal": "cylMax"}]
    },
    {
      "name": "dspRange",
      "type": "in",
      "item": {"arg": "dspValue"},
      "range": [{"signal": "dspMin"}, {"signal": "dspMax"}]
    },
    {
      "name": "lbsRange",
      "type": "in",
      "item": {"arg": "lbsValue"},
      "range": [{"signal": "lbsMin"}, {"signal": "lbsMax"}]
    },
    {
      "name": "hpRange",
      "type": "in",
      "item": {"arg": "hpValue"},
      "range": [{"signal": "hpMin"}, {"signal": "hpMax"}]
    },
    {
      "name": "accRange",
      "type": "in",
      "item": {"arg": "accValue"},
      "range": [{"signal": "accMin"}, {"signal": "accMax"}]
    },
    {
      "name": "mpgRange",
      "type": "in",
      "item": {"arg": "mpgValue"},
      "range": [{"signal": "mpgMin"}, {"signal": "mpgMax"}]
    },
    {
      "name": "yearRange",
      "type": "in",
      "item": {"arg": "yearValue"},
      "range": [{"signal": "yearMin"}, {"signal": "yearMax"}]
    },
    {
      "name": "inRange",
      "type": "and",
      "operands": [{"predicate": "cylRange"}, {"predicate": "dspRange"},
                   {"predicate": "lbsRange"}, {"predicate": "hpRange"},
                   {"predicate": "accRange"}, {"predicate": "mpgRange"},
                   {"predicate": "yearRange"}]
    },
    {
      "name": "inRangeCyl",
      "type": "and",
      "operands": [{"predicate": "inRange"}, {"predicate": "isCyl"}]
    },
    {
      "name": "inRangeDsp",
      "type": "and",
      "operands": [{"predicate": "inRange"}, {"predicate": "isDsp"}]
    },
    {
      "name": "inRangeLbs",
      "type": "and",
      "operands": [{"predicate": "inRange"}, {"predicate": "isLbs"}]
    },
    {
      "name": "inRangeHp",
      "type": "and",
      "operands": [{"predicate": "inRange"}, {"predicate": "isHp"}]
    },
    {
      "name": "inRangeAcc",
      "type": "and",
      "operands": [{"predicate": "inRange"}, {"predicate": "isAcc"}]
    },
    {
      "name": "inRangeMpg",
      "type": "and",
      "operands": [{"predicate": "inRange"}, {"predicate": "isMpg"}]
    },
    {
      "name": "inRangeYear",
      "type": "and",
      "operands": [{"predicate": "inRange"}, {"predicate": "isYear"}]
    }
  ],
  
  "data": [
    {
      "name": "cars",
      "url": "data/cars.json"
    },
    {
      "name": "fields",
      "values": ["cyl", "dsp", "lbs", "hp", "acc", "mpg", "year"]
    },
    {
      "name": "units",
      "values": [{"id": "cyl",  "name": "cylinders",    "unit": ""},
                 {"id": "dsp",  "name": "displacement", "unit": " sq in"},
                 {"id": "lbs",  "name": "weight",       "unit": " lbs"},
                 {"id": "hp",   "name": "horsepower",   "unit": " hp"},
                 {"id": "acc",  "name": "acceleration (0-60 mph)", "unit": " sec"},
                 {"id": "mpg",  "name": "mileage",      "unit": " mpg"},
                 {"id": "year", "name": "year",         "unit": ""}]
    }
  ],
  "scales": [
    {
      "name": "ord",
      "type": "ordinal",
      "range": "width", "points": true,
      "domain": {"data": "fields", "field": "data"}
    },    
    {
      "name": "cyl", "type": "linear",
      "range": "height", "zero": false, "nice": true,
      "domain": {"data": "cars", "field": "cyl"}
    },
    {
      "name": "dsp", "type": "linear",
      "range": "height", "zero": false, "nice": true,
      "domain": {"data": "cars", "field": "dsp"}
    },
    {
      "name": "lbs", "type": "linear",
      "range": "height", "zero": false, "nice": true,
      "domain": {"data": "cars", "field": "lbs"}
    },
    {
      "name": "hp", "type": "linear",
      "range": "height", "zero": false, "nice": true,
      "domain": {"data": "cars", "field": "hp"}
    },
    {
      "name": "acc", "type": "linear",
      "range": "height", "zero": false, "nice": true,
      "domain": {"data": "cars", "field": "acc"}
    },
    {
      "name": "mpg", "type": "linear",
      "range": "height", "zero": false, "nice": true,
      "domain": {"data": "cars", "field": "mpg"}
    },
    {
      "name": "year", "type": "linear",
      "range": "height", "zero": false, "nice": true,
      "domain": {"data": "cars", "field": "year"}
    },
    {
      "name": "cylColor", "type": "linear",
      "zero": false, "nice": true,
      "range": [0,255],
      "domain": {"data": "cars", "field": "cyl"}
    },
    {
      "name": "dspColor", "type": "linear",
      "zero": false, "nice": true,
      "range": [0,255],
      "domain": {"data": "cars", "field": "dsp"}
    },
    {
      "name": "lbsColor", "type": "linear",
      "zero": false, "nice": true,
      "range": [0,255],
      "domain": {"data": "cars", "field": "lbs"}
    },
    {
      "name": "hpColor", "type": "linear",
      "zero": false, "nice": true,
      "range": [0,255],
      "domain": {"data": "cars", "field": "hp"}
    },
    {
      "name": "accColor", "type": "linear",
      "zero": false, "nice": true,
      "range": [0,255],
      "domain": {"data": "cars", "field": "acc"}
    },
    {
      "name": "mpgColor", "type": "linear",
      "zero": false, "nice": true,
      "range": [0,255],
      "domain": {"data": "cars", "field": "mpg"}
    },
    {
      "name": "yearColor", "type": "linear",
      "zero": false, "nice": true,
      "range": [0,255],
      "domain": {"data": "cars", "field": "year"}
    }
  ],
  "axes": [
    { "type":"y", "scale":"cyl",  "tickSize":0, 
      "offset":{"scale":"ord", "value":"cyl"},
      "properties": {"labels": {"fill": "none"}}
    },
    { "type":"y", "scale":"dsp",  "tickSize":0, 
      "offset":{"scale":"ord", "value":"dsp"},
      "properties": {"labels": {"fill": "none"}}
    },
    { "type":"y", "scale":"lbs",  "tickSize":0, 
      "offset":{"scale":"ord", "value":"lbs"},
      "properties": {"labels": {"fill": "none"}}
    },
    { "type":"y", "scale":"hp",   "tickSize":0, 
      "offset":{"scale":"ord", "value":"hp"},
      "properties": {"labels": {"fill": "none"}}
    },
    { "type":"y", "scale":"acc",  "tickSize":0, 
      "offset":{"scale":"ord", "value":"acc"},
      "properties": {"labels": {"fill": "none"}}
    },
    { "type":"y", "scale":"mpg",  "tickSize":0, 
      "offset":{"scale":"ord", "value":"mpg"},
      "properties": {"labels": {"fill": "none"}}
    },
    { "type":"y", "scale":"year", "tickSize":0, 
      "offset":{"scale":"ord", "value":"year"},
      "properties": {"labels": {"fill": "none"}}
    }
  ],
  "marks": [
    {
      "type": "group",
      "from": {"data": "cars"},
      "marks": [
        {
          "type": "line",
          "from": {"data": "fields"},
          "properties": {
            "enter": {
              "x": {"scale": "ord", "field": "data"},
              "y": {
                "scale": {"datum": "data"}, 
                "field": {"parent": {"datum": "data"}}
              },
              "strokeWidth": {"value": 1},
              "strokeOpacity": {"value": 0.3}
            },
            "update": {
              "stroke": {
                "rule": [
                  {
                    "predicate": {
                      "name": "inRangeCyl",
                      "cylValue": {"field": {"parent": "cyl"}},
                      "dspValue": {"field": {"parent": "dsp"}},
                      "lbsValue": {"field": {"parent": "lbs"}},
                      "hpValue":  {"field": {"parent": "hp"}},
                      "accValue": {"field": {"parent": "acc"}},
                      "mpgValue": {"field": {"parent": "mpg"}},
                      "yearValue": {"field": {"parent": "year"}},
                      "id": {"signal": "brushedScale"}
                    },
                    "r": {"value": 128},
                    "g": {"value": 0},
                    "b": {"scale": "cylColor", "field": {"parent": {"signal": "brushedScale"}}}
                  },
                  {
                    "predicate": {
                      "name": "inRangeDsp",
                      "cylValue": {"field": {"parent": "cyl"}},
                      "dspValue": {"field": {"parent": "dsp"}},
                      "lbsValue": {"field": {"parent": "lbs"}},
                      "hpValue":  {"field": {"parent": "hp"}},
                      "accValue": {"field": {"parent": "acc"}},
                      "mpgValue": {"field": {"parent": "mpg"}},
                      "yearValue": {"field": {"parent": "year"}},
                      "id": {"signal": "brushedScale"}
                    },
                    "r": {"value": 128},
                    "g": {"value": 0},
                    "b": {"scale": "dspColor", "field": {"parent": {"signal": "brushedScale"}}}
                  },
                  {
                    "predicate": {
                      "name": "inRangeLbs",
                      "cylValue": {"field": {"parent": "cyl"}},
                      "dspValue": {"field": {"parent": "dsp"}},
                      "lbsValue": {"field": {"parent": "lbs"}},
                      "hpValue":  {"field": {"parent": "hp"}},
                      "accValue": {"field": {"parent": "acc"}},
                      "mpgValue": {"field": {"parent": "mpg"}},
                      "yearValue": {"field": {"parent": "year"}},
                      "id": {"signal": "brushedScale"}
                    },
                    "r": {"value": 128},
                    "g": {"value": 0},
                    "b": {"scale": "lbsColor", "field": {"parent": {"signal": "brushedScale"}}}
                  },
                  {
                    "predicate": {
                      "name": "inRangeHp",
                      "cylValue": {"field": {"parent": "cyl"}},
                      "dspValue": {"field": {"parent": "dsp"}},
                      "lbsValue": {"field": {"parent": "lbs"}},
                      "hpValue":  {"field": {"parent": "hp"}},
                      "accValue": {"field": {"parent": "acc"}},
                      "mpgValue": {"field": {"parent": "mpg"}},
                      "yearValue": {"field": {"parent": "year"}},
                      "id": {"signal": "brushedScale"}
                    },
                    "r": {"value": 128},
                    "g": {"value": 0},
                    "b": {"scale": "hpColor", "field": {"parent": {"signal": "brushedScale"}}}
                  },
                  {
                    "predicate": {
                      "name": "inRangeAcc",
                      "cylValue": {"field": {"parent": "cyl"}},
                      "dspValue": {"field": {"parent": "dsp"}},
                      "lbsValue": {"field": {"parent": "lbs"}},
                      "hpValue":  {"field": {"parent": "hp"}},
                      "accValue": {"field": {"parent": "acc"}},
                      "mpgValue": {"field": {"parent": "mpg"}},
                      "yearValue": {"field": {"parent": "year"}},
                      "id": {"signal": "brushedScale"}
                    },
                    "r": {"value": 128},
                    "g": {"value": 0},
                    "b": {"scale": "accColor", "field": {"parent": {"signal": "brushedScale"}}}
                  },
                  {
                    "predicate": {
                      "name": "inRangeMpg",
                      "cylValue": {"field": {"parent": "cyl"}},
                      "dspValue": {"field": {"parent": "dsp"}},
                      "lbsValue": {"field": {"parent": "lbs"}},
                      "hpValue":  {"field": {"parent": "hp"}},
                      "accValue": {"field": {"parent": "acc"}},
                      "mpgValue": {"field": {"parent": "mpg"}},
                      "yearValue": {"field": {"parent": "year"}},
                      "id": {"signal": "brushedScale"}
                    },
                    "r": {"value": 128},
                    "g": {"value": 0},
                    "b": {"scale": "mpgColor", "field": {"parent": {"signal": "brushedScale"}}}
                  },
                  {
                    "predicate": {
                      "name": "inRangeYear",
                      "cylValue": {"field": {"parent": "cyl"}},
                      "dspValue": {"field": {"parent": "dsp"}},
                      "lbsValue": {"field": {"parent": "lbs"}},
                      "hpValue":  {"field": {"parent": "hp"}},
                      "accValue": {"field": {"parent": "acc"}},
                      "mpgValue": {"field": {"parent": "mpg"}},
                      "yearValue": {"field": {"parent": "year"}},
                      "id": {"signal": "brushedScale"}
                    },
                    "r": {"value": 128},
                    "g": {"value": 0},
                    "b": {"scale": "yearColor", "field": {"parent": {"signal": "brushedScale"}}}
                  },
                  {"value": "gray"}
                ]
              }
            }
          }
        }
      ]
    },
    {
      "type": "text",
      "from": {"data": "units"},
      "properties": {
        "enter": {
          "x": {"scale": "ord", "field": "id"},
          "y": {"value": 0, "offset": -30},
          "fontWeight": {"value": "bold"},
          "fill": {"value": "black"},
          "text": {"field": "name"},
          "align": {"value": "center"},
          "baseline": {"value": "top"}
        }
      }
    },
    {
      "type": "text",
      "from": {"data": "units"},
      "properties": {
        "enter": {
          "x": {"scale": "ord", "field": "id"},
          "fill": {"value": "black"},
          "align": {"value": "center"},
          "baseline": {"value": "bottom"}
        },
        "update": {
          "text": {
            "rule": [
              {
                "predicate": {"name": "isCyl", "id": {"field": "id"}},
                "template": "{{cylMin|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isDsp", "id": {"field": "id"}},
                "template": "{{dspMin|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isLbs", "id": {"field": "id"}},
                "template": "{{lbsMin|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isHp", "id": {"field": "id"}},
                "template": "{{hpMin|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isAcc", "id": {"field": "id"}},
                "template": "{{accMin|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isMpg", "id": {"field": "id"}},
                "template": "{{mpgMin|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isYear", "id": {"field": "id"}},
                "template": "{{yearMin|number:'.0f'}}{{datum.unit}}"
              }
            ]
          },
          "y": {
            "rule": [
              {
                "predicate": {"name": "isCyl", "id": {"field": "id"}},
                "scale": "cyl", "signal": "cylMin"
              },
              {
                "predicate": {"name": "isDsp", "id": {"field": "id"}},
                "scale": "dsp", "signal": "dspMin"
              },
              {
                "predicate": {"name": "isLbs", "id": {"field": "id"}},
                "scale": "lbs", "signal": "lbsMin"
              },
              {
                "predicate": {"name": "isHp", "id": {"field": "id"}},
                "scale": "hp", "signal": "hpMin"
              },
              {
                "predicate": {"name": "isAcc", "id": {"field": "id"}},
                "scale": "acc", "signal": "accMin"
              },
              {
                "predicate": {"name": "isMpg", "id": {"field": "id"}},
                "scale": "mpg", "signal": "mpgMin"
              },
              {
                "predicate": {"name": "isYear", "id": {"field": "id"}},
                "scale": "year", "signal": "yearMin"
              }
            ]
          }
        }
      }
    },
    {
      "type": "text",
      "from": {"data": "units"},
      "properties": {
        "enter": {
          "x": {"scale": "ord", "field": "id"},
          "fill": {"value": "black"},
          "align": {"value": "center"},
          "baseline": {"value": "top"}
        },
        "update": {
          "text": {
            "rule": [
              {
                "predicate": {"name": "isCyl", "id": {"field": "id"}},
                "template": "{{cylMax|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isDsp", "id": {"field": "id"}},
                "template": "{{dspMax|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isLbs", "id": {"field": "id"}},
                "template": "{{lbsMax|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isHp", "id": {"field": "id"}},
                "template": "{{hpMax|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isAcc", "id": {"field": "id"}},
                "template": "{{accMax|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isMpg", "id": {"field": "id"}},
                "template": "{{mpgMax|number:'.0f'}}{{datum.unit}}"
              },
              {
                "predicate": {"name": "isYear", "id": {"field": "id"}},
                "template": "{{yearMax|number:'.0f'}}{{datum.unit}}"
              }
            ]
          },
          "y": {
            "rule": [
              {
                "predicate": {"name": "isCyl", "id": {"field": "id"}},
                "scale": "cyl", "signal": "cylMax"
              },
              {
                "predicate": {"name": "isDsp", "id": {"field": "id"}},
                "scale": "dsp", "signal": "dspMax"
              },
              {
                "predicate": {"name": "isLbs", "id": {"field": "id"}},
                "scale": "lbs", "signal": "lbsMax"
              },
              {
                "predicate": {"name": "isHp", "id": {"field": "id"}},
                "scale": "hp", "signal": "hpMax"
              },
              {
                "predicate": {"name": "isAcc", "id": {"field": "id"}},
                "scale": "acc", "signal": "accMax"
              },
              {
                "predicate": {"name": "isMpg", "id": {"field": "id"}},
                "scale": "mpg", "signal": "mpgMax"
              },
              {
                "predicate": {"name": "isYear", "id": {"field": "id"}},
                "scale": "year", "signal": "yearMax"
              }
            ]
          }
        }
      }
    },
    {
      "name": "brushRegion",
      "type": "rect",
      "from": {"data": "units"},
      "properties": {
        "enter": {
          "x": {"scale": "ord", "field": "id", "offset": -25},
          "width": {"value": 50},
          "y": {"value": 0},
          "y2": {"field": {"group": "height"}},
          "fill": {"value": "transparent"}
        }
      }
    },
    {
      "name": "filterRect",
      "type": "rect",
      "from": {"data": "units"},
      "properties": {
        "enter": {
          "x": {"scale": "ord", "field": "id", "offset": -4},
          "width": {"value": 8},
          "stroke": {"value": "white"},
          "strokeWidth": {"value": 1.5}
        },
        "update": {
          "y": {
            "rule": [
              {
                "predicate": {"name": "isCyl", "id": {"field": "id"}},
                "scale": "cyl", "signal": "cylMin"
              },
              {
                "predicate": {"name": "isDsp", "id": {"field": "id"}},
                "scale": "dsp", "signal": "dspMin"
              },
              {
                "predicate": {"name": "isLbs", "id": {"field": "id"}},
                "scale": "lbs", "signal": "lbsMin"
              },
              {
                "predicate": {"name": "isHp", "id": {"field": "id"}},
                "scale": "hp", "signal": "hpMin"
              },
              {
                "predicate": {"name": "isAcc", "id": {"field": "id"}},
                "scale": "acc", "signal": "accMin"
              },
              {
                "predicate": {"name": "isMpg", "id": {"field": "id"}},
                "scale": "mpg", "signal": "mpgMin"
              },
              {
                "predicate": {"name": "isYear", "id": {"field": "id"}},
                "scale": "year", "signal": "yearMin"
              }
            ]
          },
          "y2": {
            "rule": [
              {
                "predicate": {"name": "isCyl", "id": {"field": "id"}},
                "scale": "cyl", "signal": "cylMax"
              },
              {
                "predicate": {"name": "isDsp", "id": {"field": "id"}},
                "scale": "dsp", "signal": "dspMax"
              },
              {
                "predicate": {"name": "isLbs", "id": {"field": "id"}},
                "scale": "lbs", "signal": "lbsMax"
              },
              {
                "predicate": {"name": "isHp", "id": {"field": "id"}},
                "scale": "hp", "signal": "hpMax"
              },
              {
                "predicate": {"name": "isAcc", "id": {"field": "id"}},
                "scale": "acc", "signal": "accMax"
              },
              {
                "predicate": {"name": "isMpg", "id": {"field": "id"}},
                "scale": "mpg", "signal": "mpgMax"
              },
              {
                "predicate": {"name": "isYear", "id": {"field": "id"}},
                "scale": "year", "signal": "yearMax"
              }
            ]
          },
          "fill": {
            "rule": [
              {
                "predicate": {"name": "isBrushedCyl", "id": {"field": "id"}},
                "r": {"value": 128},
                "g": {"value": 0},
                "b": {"scale": "cylColor", "signal": "cylMiddle"}
              },
              {
                "predicate": {"name": "isBrushedDsp", "id": {"field": "id"}},
                "r": {"value": 128},
                "g": {"value": 0},
                "b": {"scale": "dspColor", "signal": "dspMiddle"}
              },
              {
                "predicate": {"name": "isBrushedLbs", "id": {"field": "id"}},
                "r": {"value": 128},
                "g": {"value": 0},
                "b": {"scale": "lbsColor", "signal": "lbsMiddle"}
              },
              {
                "predicate": {"name": "isBrushedHp", "id": {"field": "id"}},
                "r": {"value": 128},
                "g": {"value": 0},
                "b": {"scale": "hpColor", "signal": "hpMiddle"}
              },
              {
                "predicate": {"name": "isBrushedAcc", "id": {"field": "id"}},
                "r": {"value": 128},
                "g": {"value": 0},
                "b": {"scale": "accColor", "signal": "accMiddle"}
              },
              {
                "predicate": {"name": "isBrushedMpg", "id": {"field": "id"}},
                "r": {"value": 128},
                "g": {"value": 0},
                "b": {"scale": "mpgColor", "signal": "mpgMiddle"}
              },
              {
                "predicate": {"name": "isBrushedYear", "id": {"field": "id"}},
                "r": {"value": 128},
                "g": {"value": 0},
                "b": {"scale": "yearColor", "signal": "yearMiddle"}
              },
              {"value": "grey"}
            ]
          },
          "opacity": {
            "rule": [
              {
                "predicate": {"name": "isBrushed", "id": {"field": "id"}},
                "value": 1
              },
              {"value": 0.75}
            ]
          }
        }
      }
    }
  ]
}